{% extends "common/base.html" %}
{% block page_title %}Notice Management{% endblock %}

{% block content %}
<div class="card shadow-sm mb-3">
    <div class="card-body">
        <h2 class="mb-2">Create / Update Notice</h2>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="notice_id" value="">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Title</label>
                    <input name="title" type="text" class="form-control" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Active</label><br>
                    <input type="checkbox" name="is_active" checked>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Show On</label>
                    <div class="d-flex gap-3">
                        <label class="form-check-label">
                            <input type="checkbox" name="show_on_marketing" class="form-check-input me-1" checked>
                            Marketing
                        </label>
                        <label class="form-check-label">
                            <input type="checkbox" name="show_on_global" class="form-check-input me-1" checked>
                            Global User
                        </label>
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Start At</label>
                    <input name="start_at" type="datetime-local" class="form-control">
                </div>
                <div class="col-md-6">
                    <label class="form-label">End At</label>
                    <input name="end_at" type="datetime-local" class="form-control">
                </div>
                <div class="col-12">
                    <label class="form-label">Message</label>
                    <textarea name="message" class="form-control" rows="3" required></textarea>
                </div>
            </div>
            <div class="mt-3">
                <button class="btn btn-primary" type="submit">Save Notice</button>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-body">
        <h5 class="mb-3">Existing Notices</h5>
        <div class="table-responsive">
            <table class="table table-sm align-middle">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Active</th>
                        <th>Audience</th>
                        <th>Start</th>
                        <th>End</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for notice in notices_page %}
                        <tr>
                            <td>{{ notice.title }}</td>
                            <td>{{ notice.is_active|yesno:"Yes,No" }}</td>
                            <td>
                                {% if notice.show_on_marketing %}<span class="badge text-bg-primary">Marketing</span>{% endif %}
                                {% if notice.show_on_global %}<span class="badge text-bg-info text-dark">Global User</span>{% endif %}
                            </td>
                            <td>{{ notice.start_at|date:"d M Y H:i" }}</td>
                            <td>{{ notice.end_at|date:"d M Y H:i" }}</td>
                            <td>
                                <form method="post" class="d-inline" data-confirm="Expire this notice?">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="expire">
                                    <input type="hidden" name="notice_id" value="{{ notice.id }}">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">Expire</button>
                                </form>
                            </td>
                        </tr>
                    {% empty %}
                        <tr><td colspan="5" class="text-muted text-center">No notices yet.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if notices_paginator and notices_paginator.num_pages > 1 %}
        <nav>
            <ul class="pagination pagination-sm">
                <li class="page-item {% if not notices_page.has_previous %}disabled{% endif %}">
                    <a class="page-link" href="{% if notices_page.has_previous %}?page={{ notices_page.previous_page_number }}{% else %}#{% endif %}">Prev</a>
                </li>
                {% for num in notices_paginator.page_range %}
                    <li class="page-item {% if notices_page.number == num %}active{% endif %}">
                        <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                    </li>
                {% endfor %}
                <li class="page-item {% if not notices_page.has_next %}disabled{% endif %}">
                    <a class="page-link" href="{% if notices_page.has_next %}?page={{ notices_page.next_page_number }}{% else %}#{% endif %}">Next</a>
                </li>
            </ul>
        </nav>
        {% endif %}
    </div>
</div>
{% endblock %}
